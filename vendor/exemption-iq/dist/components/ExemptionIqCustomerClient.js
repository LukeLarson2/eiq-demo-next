"use client";import s,{useEffect as p,useState as t}from"react";import D from"./ExemptionIqCertificateTable";import{getApiUrl as a}from"../server/helpers/getApiUrl";function U({customerCode:i,customerInfo:c,state:C,showDownload:y=!1,manualValidation:h=!0,enableGenCertModal:g=!1,buttonText:x="Add New Certificate",buttonTextColor:S,primaryColor:k="#2966B1",dangerColor:w="#E76F51",successColor:b="#14AE5C",buttonStyles:E,onComplete:T,framework:o="next",environment:j="production"}){const[l,q]=t(null),[m,v]=t(null),[N,R]=t([]),[u,f]=t(null),[I,r]=t(!0),[d,O]=t(!1);return p(()=>{(async()=>{try{const e=await fetch(a(o,"session"),{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch session");const n=await e.json();document.cookie=`eiq_session_token=${n.token}; path=/; max-age=3600; SameSite=Lax`,O(!0)}catch(e){console.error("\u274C Failed to set session cookie",e),f("Session initialization failed"),r(!1)}})()},[]),p(()=>{if(!d)return;(async()=>{try{r(!0);const n=await(await fetch(a(o,"gencert/token"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerCode:i,...c})})).json();q(n.token),v(n.customer);const A=await(await fetch(a(o,"certificates"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerCode:i})})).json();R(A)}catch(e){console.error("\u274C Client component init error:",e),f(e.message||"Something went wrong")}finally{r(!1)}})()},[d,i]),u?s.createElement("div",{className:"mt-4 text-red-500"},s.createElement("p",null,u)):I||!l||!m?s.createElement("div",{className:"text-gray-500 italic mt-4"},"Loading exemption data..."):s.createElement(D,{token:l,certificates:N,customer:m,customerInfo:c,state:C,showDownload:y,manualValidation:h,enableGenCertModal:g,buttonText:x,buttonTextColor:S,primaryColor:k,dangerColor:w,successColor:b,buttonStyles:E,onComplete:T,framework:o,environment:j})}export{U as ExemptionIqCustomerClient};
