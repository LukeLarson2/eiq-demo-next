"use client";import{useEffect as L,useState as i}from"react";import z from"./ui/PDFModal";import M from"./ExemptionIqGencertModal";import O from"./ExemptionIqAddCertificateButton";import e from"react";import{getApiUrl as v}from"../server/helpers/getApiUrl";const n={container:{display:"flex",flexDirection:"column",gap:"1.5rem"},tableHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},heading:{fontSize:"1.25rem",fontWeight:600,color:"#1f2937"},tableContainer:{overflowX:"auto"},table:{width:"100%",borderCollapse:"collapse",backgroundColor:"#ffffff"},th:{padding:"0.75rem 1.5rem",textAlign:"left",fontSize:"0.75rem",fontWeight:600,textTransform:"uppercase",color:"#6b7280",letterSpacing:"0.05em",borderBottom:"1px solid #e5e7eb",backgroundColor:"#f9fafb"},td:{padding:"1rem 1.5rem",whiteSpace:"nowrap",borderBottom:"1px solid #e5e7eb",fontSize:"0.875rem",color:"#1f2937"},actionRow:{display:"flex",gap:"1.5rem"},actionButton:{background:"none",border:"none",cursor:"pointer",font:"inherit",transition:"opacity 0.2s ease"},emptyCell:{textAlign:"center",color:"#6b7280",padding:"1rem"}};function U({token:f,sessionToken:p,certificates:E,customer:t,state:A,showDownload:c=!1,manualValidation:m=!0,buttonText:D="Add New Certificate",buttonTextColor:N,primaryColor:u="#2966B1",successColor:k="#14AE5C",dangerColor:T="#E76F51",buttonStyles:I,onComplete:B,framework:y="next",environment:C="production"}){const[b,P]=i(E),[a,x]=i(null),[q,r]=i(!1),[F,l]=i(!1),[g,s]=i(null);L(()=>{p&&(document.cookie=`eiq_session_token=${p.token}; path=/; max-age=3600; SameSite=Lax`)},[]);const h=async()=>{try{const o=await fetch(v(y,"certificates"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerCode:t.customerCode})});if(!o.ok)throw new Error("Failed to fetch updated certificates");const d=await o.json();P(d),l(!1),r(!1),s(null)}catch(o){console.error("Error refreshing certificates:",o)}finally{window.location.reload()}},w=o=>{const d=new Date,S=(new Date(o).getTime()-d.getTime())/(1e3*60*60*24);return S<=30&&S>=0};return e.createElement("div",{style:n.container},a&&e.createElement(z,{isOpen:!!a,onClose:()=>x(null),pdfUrl:a,title:"Certificate PDF Preview"}),e.createElement("div",{style:n.tableHeader},e.createElement("h2",{style:n.heading},t.name," Exemption Certificates"),e.createElement(O,{token:f,state:A,customerCode:t.customerCode,customerInfo:{name:t.name,emailAddress:t.emailAddress,addressLine1:t.line1,addressLine2:t.line2,city:t.city,postalCode:t.postalCode,phoneNumber:t.phoneNumber,faxNumber:t.faxNumber,country:t.country,region:t.region},certificateComplete:h,showDownload:c,manualValidation:m,buttonText:D,buttonTextColor:N,primaryColor:u,buttonStyles:I,onComplete:B,environment:C})),e.createElement("div",{style:n.tableContainer},e.createElement("table",{style:n.table},e.createElement("thead",null,e.createElement("tr",null,["Status","Exposure Zone","Reason","Signed Date","Expiration Date","Actions"].map(o=>e.createElement("th",{key:o,style:n.th},o)))),e.createElement("tbody",null,b.map(o=>e.createElement("tr",{key:o.id},e.createElement("td",{style:n.td},e.createElement("span",{style:{textTransform:"capitalize",fontWeight:500,color:o.status==="valid"?"#16a34a":o.status==="expired"?"#dc2626":o.status==="invalid"?"#ea580c":"#4b5563"}},o.status)),e.createElement("td",{style:n.td},o.exposureZone),e.createElement("td",{style:n.td},o.exemptionReason),e.createElement("td",{style:n.td},o.signedDate),e.createElement("td",{style:{...n.td,color:w(o.expirationDate)?T:void 0,fontWeight:w(o.expirationDate)?600:void 0}},o.expirationDate),e.createElement("td",{style:n.td},e.createElement("div",{style:n.actionRow},e.createElement("button",{onClick:()=>x(v(y,`certificate/${o.id}`)),title:"View Certificate",style:{...n.actionButton,color:u}},"View"),e.createElement("button",{onClick:()=>{s(o),l(!0),r(!0)},title:"Renew Certificate",style:{...n.actionButton,color:k}},"Renew"))))),b.length===0&&e.createElement("tr",null,e.createElement("td",{colSpan:6,style:n.emptyCell},'No certificates found. Click "Add New Certificate" to create one.'))))),F&&g&&e.createElement(M,{isOpen:q,onClose:()=>{r(!1),l(!1),s(null)},token:f,state:g.exposureZone,customerCode:t.customerCode,customerInfo:{name:t.name,emailAddress:t.emailAddress,addressLine1:t.line1,addressLine2:t.line2,city:t.city,postalCode:t.postalCode,phoneNumber:t.phoneNumber,faxNumber:t.faxNumber,country:t.country,region:t.region},disableCustomerFields:!0,showDownload:c,manualValidation:m,onCertificateComplete:h,mode:"renew",environment:C}))}export{U as default};
