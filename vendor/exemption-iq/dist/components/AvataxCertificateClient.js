"use client";import{useEffect as _,useState as d,useRef as A}from"react";import r from"react";const n={container:{width:"100%",height:"35rem",position:"relative",overflowY:"auto"},loadingOverlay:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(255, 255, 255, 0.9)",zIndex:10},spinner:{height:"3rem",width:"3rem",borderRadius:"9999px",borderBottom:"2px solid #3b82f6",animation:"eiq-spin 1s linear infinite"},loadingText:{marginTop:"1rem",color:"#4b5563",textAlign:"center"},formContainer:{width:"100%",height:"100%"},closeBtnContainer:{position:"absolute",top:"0.5rem",right:"0.5rem",display:"flex",gap:"0.5rem",zIndex:50},closeBtn:{padding:"0.5rem 1rem",backgroundColor:"white",color:"#1f2937",border:"1px solid #e5e7eb",borderRadius:"0.375rem",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)",cursor:"pointer",transition:"background-color 0.2s ease-in-out"},closeBtnHover:{backgroundColor:"#f3f4f6"},errorBox:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"0.5rem",padding:"1rem",color:"#b91c1c",fontWeight:500},keyframes:`
    @keyframes eiq-spin {
      to {
        transform: rotate(360deg);
      }
    }
  `};function L({token:p,state:o,showDownload:c=!1,manualValidation:h=!0,onCertificateComplete:m,onClose:b,customerInfo:t,shouldPrefillState:w=!0,mode:x,onComplete:e,customerCode:v,environment:C="production"}){const[g,l]=d(null),[B,a]=d(!0),[y,z]=d(!1),[E,S]=d(!1),f=A(null),k=()=>{window.GenCert&&(window.GenCert.hide(),b())};return _(()=>{if(typeof window!="undefined"&&!document.getElementById("eiq-spin-style")){const i=document.createElement("style");i.id="eiq-spin-style",i.textContent=n.keyframes,document.head.appendChild(i)}if(y)return;const u=(()=>{const i=document.createElement("script");return i.src=C==="production"?"https://app.certcapture.com/gencert2/js":"https://sbx.certcapture.com/gencert2/js",i.crossOrigin="anonymous",i.onload=()=>{if(f.current&&window.GenCert)try{window.GenCert.init(f.current,{token:p,customer_number:v,ship_zone:x==="renew"&&w?o:"",preview:c,show_files:c,submit_to_stack:h,onCertSuccess:()=>{var s;if(S(!0),(s=window.GenCert.certificateIds)!=null&&s.length){const G=window.GenCert.certificateIds[0];m(G),e==null||e(!0)}else e==null||e(!1)}}),t&&x==="renew"&&window.GenCert.setCustomerData({name:t.name,address1:t.addressLine1,address2:t.addressLine2,city:t.city,zip:t.postalCode,phone:t.phoneNumber,fax:t.faxNumber,email:t.emailAddress,state:o}),window.GenCert.setShipZone(o),window.GenCert.show(),a(!1),z(!0)}catch(s){console.error("Error initializing certificate form:",s),l("Failed to initialize the tax exemption certificate form."),a(!1),e==null||e(!1)}else l("The tax exemption certificate form could not be loaded."),a(!1),e==null||e(!1)},i.onerror=()=>{console.error("Failed to load certificate widget script."),l("Failed to load the tax exemption certificate system."),a(!1),e==null||e(!1)},document.body.appendChild(i),i})();return()=>{u&&document.body.contains(u)&&document.body.removeChild(u),document.querySelectorAll("style").forEach(i=>{var s;(s=i.textContent)!=null&&s.includes("form_container iframe")&&i.remove()})}},[p,o,c,y,m,t]),g?r.createElement("div",{style:n.container},r.createElement("div",{style:n.errorBox},r.createElement("p",null,"Error: ",g))):r.createElement("div",{style:n.container},B&&r.createElement("div",{style:n.loadingOverlay},r.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},r.createElement("div",{style:n.spinner}),r.createElement("p",{style:n.loadingText},"Loading tax exemption certificate form..."))),r.createElement("div",{ref:f,id:"form_container",style:n.formContainer,"aria-label":"Tax Exemption Certificate Form",role:"dialog"}),E&&r.createElement("div",{style:n.closeBtnContainer},r.createElement("button",{onClick:k,style:n.closeBtn},"Close Certificate")))}export{L as default};
