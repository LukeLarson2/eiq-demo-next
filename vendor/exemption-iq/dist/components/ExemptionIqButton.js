"use client";import{useEffect as H,useState as o}from"react";import J from"./AvataxCertificateClient";import k from"./ui/Modal";import Y from"./ui/PDFModal";import e from"react";import{getApiUrl as K}from"../server/helpers/getApiUrl";const r={button:{padding:"0.75rem 1.5rem",borderRadius:"6px",fontWeight:500,transition:"all 150ms ease-in-out",display:"inline-flex",alignItems:"center",justifyContent:"center",border:"none"},spinner:{animation:"spin 1s linear infinite",marginRight:"0.75rem",height:"1.25rem",width:"1.25rem"},certModal:{display:"flex",flexDirection:"column",gap:"1rem"},certBox:{backgroundColor:"#f9fafb",padding:"1rem",borderRadius:"0.5rem",border:"1px solid #d1d5db"},certActions:{display:"flex",justifyContent:"flex-end",gap:"1rem",paddingTop:"1rem"},viewPdf:{color:"#2563eb",textDecoration:"underline",background:"none",border:"none",cursor:"pointer",font:"inherit"},useCertBtn:{backgroundColor:"#e5e7eb",fontSize:"0.875rem",padding:"0.5rem 1rem",borderRadius:"4px",border:"none",cursor:"pointer"},uploadCertBtn:{color:"white",fontSize:"0.875rem",padding:"0.5rem 1rem",borderRadius:"4px",border:"none",cursor:"pointer"},successBtn:{backgroundColor:"#14AE5C",color:"#fff",padding:"0.5rem 1rem",borderRadius:"4px",opacity:.75,cursor:"not-allowed",border:"none"}};if(typeof window<"u"&&!document.getElementById("eiq-btn-keyframes")){const t=document.createElement("style");t.id="eiq-btn-keyframes",t.innerHTML="@keyframes spin { to { transform: rotate(360deg); } }",document.head.appendChild(t)}function Q({token:t,sessionToken:a,isAuthorized:s,state:C,showDownload:I=!1,manualValidation:M=!1,buttonText:U="Tax Exempt",buttonTextColor:q,primaryColor:b="#2966B1",dangerColor:x="#E76F51",successColor:F="#14AE5C",buttonStyles:w,customerCode:n,customerInfo:L,onComplete:y,persistAfterSuccess:v=!1,matchingCertificate:i,framework:T="next",environment:N="production"}){const[X,O]=o(!1),[u,Z]=o(null),[l,S]=o(!1),[f,p]=o(!1),[R,V]=o(null),[c,h]=o(!1),[$,B]=o(!1),[j,d]=o(!1),[m,D]=o(null);H(()=>{if(a){const g=new Date(Date.now()+36e5).toUTCString();document.cookie=`eiq_session_token=${a.token}; path=/; expires=${g}; secure; samesite=Lax`}},[a]);const A=()=>!n||!s||!t||u?x:c?F:b,G=()=>n?!s||!t?"Unauthorized":l?"Processing...":c?"Exempt \u2713":U:"No Customer Code",W=()=>{!n||!s||!t||(i?d(!0):(O(!0),p(!0)))},_=g=>{V(g),B(!0),S(!1)},E=()=>{p(!1),S(!1),$&&!v&&h(!0),B(!1)},P=w?JSON.parse(w):{},z={...r.button,backgroundColor:A(),color:q||"#fff",cursor:!n||!s||!t||l?"not-allowed":"pointer",opacity:!n||!s||!t||l?.7:1,...P};return c&&!v?e.createElement("div",{style:{width:"100%"}},e.createElement("button",{disabled:!0,style:{...r.successBtn,...P}},"Exempt \u2713")):e.createElement("div",null,!f&&e.createElement("button",{onClick:W,disabled:!n||!s||!t||l,style:z},e.createElement("span",{style:{display:"inline-flex",alignItems:"center"}},l&&e.createElement("svg",{style:r.spinner,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},e.createElement("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.createElement("path",{fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291..."})),G())),j&&i&&e.createElement(k,{isOpen:!0,onClose:()=>d(!1)},e.createElement("div",{style:r.certModal},e.createElement("h2",{style:{fontSize:"1rem",color:"#374151"}},"A valid certificate already exists for ",C),e.createElement("p",{style:{fontSize:"0.875rem",color:"#6b7280"}},"You can use this certificate or upload a new one."),e.createElement("div",{style:r.certBox},e.createElement("p",null,e.createElement("strong",null,"Reason:")," ",i.actualTaxCode.name),e.createElement("p",null,e.createElement("strong",null,"Signed:")," ",new Date(i.certificate.signedDate).toLocaleDateString()),e.createElement("p",null,e.createElement("strong",null,"Expires:")," ",i.certificate.expirationDate?new Date(i.certificate.expirationDate).toLocaleDateString():"N/A"),e.createElement("button",{style:r.viewPdf,onClick:()=>D(K(T,`certificate/${i.id}`))},"View PDF")),e.createElement("div",{style:r.certActions},e.createElement("button",{style:r.useCertBtn,onClick:()=>{d(!1),h(!0),y?.(!0)}},"Use This Certificate"),e.createElement("button",{style:{...r.uploadCertBtn,backgroundColor:b},onClick:()=>{d(!1),p(!0)}},"Upload New Certificate")))),m&&e.createElement(Y,{isOpen:!!m,onClose:()=>D(null),pdfUrl:m,title:"Certificate PDF Preview"}),f&&t&&e.createElement(k,{isOpen:f,onClose:E},e.createElement(J,{token:t,state:C,showDownload:I,manualValidation:M,onCertificateComplete:_,onClose:E,customerCode:n,customerInfo:L,mode:"renew",onComplete:y,environment:N})),u&&e.createElement("div",{style:{marginTop:"1rem",color:"#ef4444"}},e.createElement("p",null,u)))}export{Q as default};
